stages:
    - build
    
build:
    stage: build
    script:
        - chmod +x /usr/bin/ssh
        - mkdir -p ~/.ssh
        - echo -e $BLUEBECKS_KEY > ~/.ssh/id_rsa.pub
        - chmod 600 ~/.ssh/id_rsa.pub
        - ssh -t -t -o StrictHostKeyChecking=no root@144.217.241.43
        - ls
        - cd /var/www/
        - sudo su www-data -s /bin/bash
        - if [ ! -f citest ]; then
              git clone git@gitlab.com:franko4don/citest.git
          fi

        - if [ -f citest ]; then
              git pull git@gitlab.com:franko4don/citest.git
          fi
        - exit
        - cd /var/www/citest
        - composer install
        - if [ ! -f /home/admin/conf/web/citest.conf ]; then
              cp citest.conf /home/admin/conf/web/citest.conf && service nginx restart && certbot --nginx -d citest.bluebecks.com
          fi
        - exit
        
